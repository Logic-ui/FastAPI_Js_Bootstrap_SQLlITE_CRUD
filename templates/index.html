{% extends "base.html" %}
{% block content %}
<section>
  <h2>Tasks</h2>
  {% if tasks %}
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Title</th>
        <th>Description</th>
        <th>Completed</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for task in tasks %}
      <tr>
        <td>{{ task.id }}</td>
        <td>{{ task.title }}</td>
        <td>{{ task.description }}</td>
        <td>
          {% if task.completed %}
          <span class="status status-yes">‚úî Completed</span>
          {% else %}
          <span class="status status-no">‚úñ Pending</span>
          {% endif %}
        </td>

        <td>
          <a href="/edit/{{ task.id }}">Edit</a>
          <button onclick="deleteTask({{ task.id }})">Delete</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Pagination -->
  {% if total_pages > 1 %}
  <nav class="pagination">
    <ul>
      {% if page > 1 %}
      <li><a href="/?page={{ page - 1 }}">‚èÆ Prev</a></li>
      {% endif %}

      {% for p in range(1, total_pages + 1) %}
        {% if p == page %}
          <li class="active"><span>{{ p }}</span></li>
        {% else %}
          <li><a href="/?page={{ p }}">{{ p }}</a></li>
        {% endif %}
      {% endfor %}

      {% if page < total_pages %}
      <li><a href="/?page={{ page + 1 }}">Next ‚è≠</a></li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}

  <a class="btn-download" href="/download/pdf">üìÑ Download PDF</a>
  {% else %}
  <p>No tasks yet ‚Äî <a href="/create">create one</a>.</p>
  {% endif %}
</section>

<script>
  function deleteTask(taskId) {
    if (confirm("Are you sure you want to delete this task?")) {
      fetch(`/delete/${taskId}`, {
        method: "DELETE",
      })
        .then((response) => {
          if (response.ok) {
            location.reload();
          } else {
            alert("Error deleting task");
          }
        })
        .catch((error) => console.error("Error:", error));
    }
  }
</script>
{% endblock %}