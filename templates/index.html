{% extends "base.html" %} {% block content %}
<section>
  <h2>Tasks</h2>
  {% if tasks %}
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Title</th>
        <th>Description</th>
        <th>Completed</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for task in tasks %}
      <tr>
        <td>{{ task.id }}</td>
        <td>{{ task.title }}</td>
        <td>{{ task.description }}</td>
        <td>
          {% if task.completed %}
          <span class="status status-yes">✔ Completed</span>
          {% else %}
          <span class="status status-no">✖ Pending</span>
          {% endif %}
        </td>

        <td>
          <a href="/edit/{{ task.id }}">Edit</a>
          <button onclick="deleteTask({{ task.id }})">Delete</button>

          <script>
            function deleteTask(taskId) {
              if (confirm("Are you sure you want to delete this task?")) {
                fetch(`/delete/${taskId}`, {
                  method: "DELETE", // or POST if your FastAPI route expects POST
                })
                  .then((response) => {
                    if (response.ok) {
                      // Reload page or remove the row from DOM
                      location.reload();
                    } else {
                      alert("Error deleting task");
                    }
                  })
                  .catch((error) => console.error("Error:", error));
              }
            }
          </script>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p>No tasks yet — <a href="/create">create one</a>.</p>
  {% endif %}
</section>
{% endblock %}
